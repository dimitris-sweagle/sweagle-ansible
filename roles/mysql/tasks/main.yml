---
# Install MYSQL
- name: Install MySQL packages for Red Hat
  package:
    name: "{{ item }}"
    state: present
  with_items:
    - mysql-community-server
    - mysql-community-client
    - MySQL-python
  become: true
  become_user: root
  when: ansible_distribution == 'CentOS'
    or ansible_distribution == 'RedHat'
    or ansible_distribution == 'Red Hat Enterprise Linux'
  tags: mysql

- name: Install MySQL packages for Debian
  package:
    name: "{{ item }}"
    state: present
  with_items:
    - mysql-server
    - mysql-common
    - python-mysqldb
  become: true
  become_user: root
  when: ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu'
  tags: mysql

- name: Configure MySQL
  template:
    src: "my.cnf.j2"
    dest: "{{ mysql_config_dir }}/my.cnf"
    mode: preserve
  become: true
  become_user: root
  notify: "Restart mysql"
  tags: mysql

- name: Check mysql service is running
  service:
    name: mysql
    enabled: yes
    state: started
  tags: mysql

- name: Include SWEAGLE configuration.yml
  include: configure-sweagle.yml
  tags: [ mysql, sweagle, sweagle-mysql ]
